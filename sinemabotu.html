<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sinema Botu</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech&display=swap');
        
@media (max-width: 600px) {
    #main-container {
        width: 90vw !important; 
        max-width: 350px;      
        height: auto !important;
        min-height: 500px;
        flex-direction: column !important;
        border-radius: 20px !important;
        margin: 20px auto !important;
        padding: 15px !important;
        box-shadow: 0px 10px 30px rgba(0,0,0,0.5) !important;
    }

    #point-container {
        width: 100% !important;
        height: auto !important;
        flex-direction: column !important;
        padding: 10px 0 !important;
    }

    #slider {
        rotate: 0deg !important; 
        transform: none !important;
        width: 100% !important; 
        margin: 20px 0 !important;
    }

    #point-container div {
        transform: none !important;
        position: static !important;
        margin: 5px 0 !important;
    }

    #category-container {
        grid-template-columns: repeat(3, 1fr) !important; 
        gap: 25px !important;
        margin: 10px 0 !important;
        width: 100% !important;
        justify-content: center;
        align-items: center;
        display: flex;
    }

    .category {
        width: 115% !important; 
        height: 100px !important;
    }

    .category img {
        width: 60px !important;
        height: 60px !important;
        top: 15px !important;
    }

    .category h4 {
        font-size: 0.8rem !important;
    }

    /* Sonuç Ekranı */
    #result-container {
        flex-direction: column !important;
        width: 100% !important;
    }

    #result-container img {
        width: 100% !important;
        max-width: 320px; /* Afiş çok büyük olup ekranı kaplamasın */
        height: auto !important;
        border-radius: 15px !important;
        border: 3px solid #eee !important;
    }

    #right-section {
        width: 100% !important;
        text-align: center;
        justify-content: center;
        align-items: center;
        padding: 10px 0 !important;
    }

    #right-section h2 {
        font-size: 1.3rem !important;
        margin-top: 10px !important;
    }

    #summary {
        max-height: 100px; /* Metin çok uzunsa ekranı patlatmasın */
        overflow-y: auto;
        font-size: 0.8rem !important;
    }
}
        body {
            background-color: black;
        }

        *{
            color: white;
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }

        #main-container {
            margin: 20px auto;
            position: relative;
            background-color: #0B0E14;
            width: 35rem;
            height: 34em;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            border-radius: 0 42px 42px 0;
            transition: 0.5s ease-in-out;
            box-shadow: 0px 0px 0px 0px #ffffff;}

        #search-container {
            display: flex;  
        }

        #category-container{
            margin: auto 2rem;
            display: grid;
            grid-template-columns: repeat(3,1fr);
            grid-template-rows: repeat(3,1fr);
            gap: 2rem;
        }

        .category {
            background-color: #1A1F29;
            height: 8rem;
            width: 8rem;
            border-radius: 20px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            cursor: pointer;
            position: relative;
        }
        
        .category img {
            filter: grayscale(80%);
            margin-top : -0.6rem;
            justify-self: center;
            width: 5rem;
            height: 5rem;
            position: absolute;
            top: 1.5rem;
            transition: 0.3s ease-in-out;
        }

        .category:hover img {
            filter: grayscale(13%);
            transform: scale(1.1);
            transition: 0.3s ease-in-out;
        }

        .category h4 {
            width: 100%;
            padding: 0.2rem;
            text-align: center;
            border-radius: 0 0 20px 20px;
            font-family: "Share Tech Mono", monospace;
            font-size: 1rem;
        }

        #point-container {
            background-color: #11141c;
            width: 3.5rem;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem 0;
            font-family: "Share Tech Mono", monospace;
        }

        #point-container div{
            margin-top: 1.5rem;
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.7rem;
            transform: translateY(12.5rem);
        }
        
        #slider {
            -webkit-appearance: none;
            appearance: none;
            margin-top: 2rem;
            width: 27rem; 
            height: 1rem;
            background: #444;
            outline: none;
            border-radius: 14px;
            cursor: pointer;
            rotate: -90deg;
            padding: 0;
            --thumb-glow: 0px;
            --thumb-color: rgb(238, 203, 0);
        }

        #slider::-webkit-slider-thumb {
            -webkit-appearance: none; 
            appearance: none;
            rotate: 90deg;
            width: 3.5rem;  
            height: 3.5em; 
            background-image: url('https://cdn-icons-png.flaticon.com/512/2107/2107957.png'); 
            background-size: contain; 
            background-repeat: no-repeat;
            background-position: center;
            background-color: transparent; 
            border: none; 
            cursor: pointer;
            filter: drop-shadow(0 0 var(--thumb-glow) var(--thumb-color));
            transition: filter 0.2s ease; 
        }

        .super-charge::-webkit-slider-thumb {
            animation: star-shake-new 0.1s infinite linear !important;
            filter: drop-shadow(0 0 30px #ffffff) brightness(1.8) !important;
            transition: none !important;
        }

        @keyframes star-shake-new {
            0% { margin-top: 0px; margin-left: 0px; }
            25% { margin-top: -3px; margin-left: 3px; }
            50% { margin-top: 3px; margin-left: -3px; }
            75% { margin-top: -2px; margin-left: -2px; }
            100% { margin-top: 0px; margin-left: 0px; }
        }

        #result-container {
            width:100%;
            display: none;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            color: rgb(255, 255, 255);
            transition: 0.5s ease-in-out;
        }

        #result-container img {
            width: 17rem;
            height: 100%;
            border: 5px solid rgb(255, 255, 255);
            border-radius: 0 30px 30px 0;
        }

        #right-section h2,p{
            color: rgb(255, 255, 255);
            font-family: 'Share Tech', monospace;
        }

        #right-section h2 {
            margin-top: 3rem;
            font-size: 1.9rem;
        }

        #right-section {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-right: 1rem ;
            padding: 0.1rem;
            width: 15rem;
            height: 100%;
        }

        #second-section {
            display: flex;
            gap: 1rem;
        }

        #summary{
            font-size: .7rem;
            margin-top: 0.7rem;
            margin-bottom: 1.3rem;
            height: 100%; 
            overflow: hidden;
        }

        #newQuery-btn{
            margin: auto auto 1.5rem auto;
            text-align: center;
            border: none;
            width: 140px;
            height: 50px;
            color: #fff;
            z-index: 1;
            display: flex;
            background: #b1b1b1;
            position: relative;
            cursor: pointer;}

        #newQuery-btn p {
            margin: 0 auto;
            align-self: center;
            font-size: 17px;
            font-weight: bold;
            text-align: center;
            color: white;
            }

        #newQuery-btn::after {
            position: absolute;
            content: "";
            width: 100%;
            z-index: -1;
            height: 10%;
            bottom: 0;
            clip-path: polygon(
                0% 74%,
                4% 75%,
                8% 76%,
                11% 77%,
                15% 78%,
                20% 78%,
                25% 77%,
                32% 77%,
                37% 75%,
                40% 74%,
                43% 74%,
                46% 73%,
                52% 72%,
                57% 72%,
                65% 74%,
                66% 75%,
                71% 78%,
                75% 82%,
                81% 86%,
                83% 88%,
                88% 91%,
                90% 94%,
                94% 96%,
                98% 98%,
                100% 100%,
                82% 100%,
                0 100%
            );
            background: #747474;
            transition: 0.2s ease;
            }

        #newQuery-btn::before {
            position: absolute;
            content: "";
            transform: rotate(180deg);
            width: 100%;
            height: 10%;
            transition: 0.2s ease;
            z-index: -1;
            clip-path: polygon(
                0% 74%,
                4% 75%,
                8% 76%,
                11% 77%,
                15% 78%,
                20% 78%,
                25% 77%,
                32% 77%,
                37% 75%,
                40% 74%,
                43% 74%,
                46% 73%,
                52% 72%,
                57% 72%,
                65% 74%,
                66% 75%,
                71% 78%,
                75% 82%,
                81% 86%,
                83% 88%,
                88% 91%,
                90% 94%,
                94% 96%,
                98% 98%,
                100% 100%,
                82% 100%,
                0 100%
            );
            background: #cccccc;
            }

        #newQuery-btn:hover::after {
            clip-path: polygon(
                0 30%,
                9% 34%,
                7% 39%,
                11% 43%,
                13% 33%,
                17% 30%,
                24% 34%,
                25% 35%,
                30% 31%,
                30% 38%,
                39% 33%,
                35% 43%,
                43% 45%,
                55% 46%,
                65% 74%,
                67% 66%,
                81% 57%,
                75% 82%,
                81% 86%,
                83% 88%,
                88% 91%,
                90% 94%,
                94% 96%,
                98% 98%,
                100% 100%,
                82% 100%,
                0 100%
            );
            height: 80%;
            }

        #newQuery-btn:hover::before {
            clip-path: polygon(
                0 30%,
                9% 34%,
                7% 39%,
                11% 43%,
                13% 33%,
                17% 30%,
                24% 34%,
                25% 35%,
                30% 31%,
                30% 38%,
                39% 33%,
                35% 43%,
                43% 45%,
                55% 46%,
                65% 74%,
                67% 66%,
                81% 57%,
                75% 82%,
                81% 86%,
                83% 88%,
                88% 91%,
                90% 94%,
                94% 96%,
                98% 98%,
                100% 100%,
                82% 100%,
                0 100%
            );
            height: 80%;
            }
        
    </style>
</head>
<body>
    <div id="main-container">
        <div id="point-container">
            <input type="range" id="slider" min="1" max="9" value="1" step="0.5">
            <div id="point">1</div>
        </div>
        <div id="search-container">
            <div id="category-container">
                <div class="category" data-id="28"><img src="https://cdn-icons-png.flaticon.com/512/3857/3857467.png"><h4>Aksiyon</h4></div>
                <div class="category" data-id="53"><img src="https://cdn-icons-png.flaticon.com/512/188/188568.png"><h4>Gerilim</h4></div>
                <div class="category" data-id="35"><img src="https://cdn-icons-png.flaticon.com/512/8468/8468485.png"><h4>Komedi</h4></div>
                <div class="category" data-id="18"><img src="https://cdn-icons-png.flaticon.com/512/1049/1049352.png"><h4>Dram</h4></div>
                <div class="category" data-id="10749"><img src="https://cdn-icons-png.flaticon.com/512/11009/11009785.png"><h4>Romantik</h4></div>
                <div class="category" data-id="10752"><img src="https://cdn-icons-png.flaticon.com/512/861/861908.png"><h4>Savaş</h4></div>
                <div class="category" data-id="878"><img src="https://cdn-icons-png.flaticon.com/512/620/620689.png"><h4>Bilim-Kurgu</h4></div>
                <div class="category" data-id="16"><img src="https://cdn-icons-png.flaticon.com/512/891/891948.png"><h4>Animasyon</h4></div>
                <div class="category" data-id="80"><img src="https://cdn-icons-png.flaticon.com/512/8858/8858927.png"><h4>Suç</h4></div>
            </div>
        </div>
        <div id="result-container">
            <div id="left-section"><img src="" alt=""></div>
            <div id="right-section">
                <h2 id="movie-name"></h2>
                <div id="second-section"><p id="director"></p><p></p><p id="category" style="color: red;">Dram</p></div>
                <p id="summary"></p>
                <button id="newQuery-btn"><p>Yeniden Arat</p></button>
        </div>
    </div>
</body>
</html>

<script>

    let pointReader = document.getElementById("slider");
    const newQueryBtn = document.getElementById("newQuery-btn");
    const categories = document.querySelectorAll(".category");
    let point = pointReader.value;
    console.log(point);


    pointReader.addEventListener("input", function() {
    
        let glowSize = point * 3; 
        
        if (point >= 8) {
            this.classList.add("super-charge");
            this.style.setProperty('--thumb-glow', (point * 6) + 'px');
            this.style.setProperty('--thumb-color', 'white'); 
        } else {
            this.classList.remove("super-charge");
            this.style.setProperty('--thumb-glow', glowSize + 'px');
            this.style.setProperty('--thumb-color', 'rgb(238, 203, 0)');
        }
    });

categories.forEach(category => {
    category.addEventListener("click", function() {
        const selectedGenreId = this.getAttribute("data-id");
        const minPoint = pointReader.value; 
        filmGetir(minPoint, selectedGenreId);
        setTimeout(() => {
            document.getElementById("point-container").style.display = "none";
            document.getElementById("search-container").style.display = "none";
            document.getElementById("result-container").style.display = "flex";
        }, 150);
            document.getElementById("main-container").style.height = 22 + "rem";
            document.getElementById("main-container").style.width = 34 + "rem";
            document.getElementById("main-container").style.boxShadow = "22px 13px 150px 3px #ffffff";            
            document.getElementById("main-container").style.backgroundColor = "white";
            document.getElementById("newQuery-btn").style.color = "white";
            document.querySelectorAll("#right-section h2,#right-section p:not(#category)").forEach(el => {
            el.style.color = "#222";
        });

        });
    });
    
    newQueryBtn.addEventListener("click", function() {
        setTimeout(() => {
            document.getElementById("point-container").style.display = "flex";
            document.getElementById("search-container").style.display = "block";
            document.getElementById("result-container").style.display = "none";
        }, 310);
        document.getElementById("main-container").style.height = 34 + "rem";
        document.getElementById("main-container").style.width = 34 + "rem";
        document.getElementById("main-container").style.boxShadow = "0px 0px 0px 0px #ffffff";
        document.getElementById("main-container").style.backgroundColor = "#0B0E14";

    });
    document.addEventListener("input", function() {
        point = pointReader.value;
        document.getElementById("point").innerText = point;
    });


    const API_KEY = 'abbd32b1163453a042fe701f1a038874'; //APİYİ PATLATAN OÇTUR // IM BEGGİN DO NOT TOUCH APİ
    const BASE_URL = 'https://api.themoviedb.org/3';

async function filmGetir(puan, kategoriId, denemeSayisi = 0) {
    if (denemeSayisi > 3) {
        puan = Math.max(1, puan - 1);
    }

    const rastgeleSayfa = Math.floor(Math.random() * 41) + 1; 
    const url = `${BASE_URL}/discover/movie?api_key=${API_KEY}&language=tr-TR&sort_by=vote_average.desc&vote_count.gte=200&vote_average.gte=${puan}&with_genres=${kategoriId}&page=${rastgeleSayfa}`;    
    try {
        const response = await fetch(url);
        const data = await response.json();

        const uygunFilmler = data.results.filter(f => {
            const isPrimaryGenre = f.genre_ids[0] == Number(kategoriId);
            
            if (kategoriId == "18") {
                const yasakliTurler = [28, 12, 878]; 
                const baskinTurVarMi = f.genre_ids.some(id => yasakliTurler.includes(id));
                return f.overview && f.poster_path && isPrimaryGenre && !baskinTurVarMi && f.vote_average >= Number(puan);
            }

    return f.overview && f.poster_path && isPrimaryGenre && f.vote_average >= Number(puan);
});

        let secilenFilm;

        if (uygunFilmler.length > 0) {
            secilenFilm = uygunFilmler[Math.floor(Math.random() * uygunFilmler.length)];
        } else {
            if (denemeSayisi < 5) {
                return filmGetir(puan, kategoriId, denemeSayisi + 1);
            } else {
                alert("Bu kriterlerde film bulunamadı, lütfen puanı düşürün.");
                location.reload(); 
                return;
            }
        }

        document.getElementById("movie-name").innerText = secilenFilm.title;
        const posterImg = document.querySelector("#left-section img");
        posterImg.src = `https://image.tmdb.org/t/p/w500${secilenFilm.poster_path}`;
        
        let words = secilenFilm.overview.split(/\s+/);
        document.getElementById("summary").innerText = words.length > 60 
            ? words.slice(0, 60).join(" ") + "..." 
            : secilenFilm.overview;


        const tiklananKategoriObjesi = document.querySelector(`.category[data-id="${kategoriId}"] h4`);
        const kategoriIsmi = tiklananKategoriObjesi ? tiklananKategoriObjesi.innerText : "Film";

        document.getElementById("category").innerText = kategoriIsmi;
        const creditsUrl = `${BASE_URL}/movie/${secilenFilm.id}/credits?api_key=${API_KEY}`;
        const creditsResponse = await fetch(creditsUrl);
        const creditsData = await creditsResponse.json();
        const director = creditsData.crew.find(person => person.job === 'Director');
        
        document.getElementById("director").innerText = director ? director.name : "Yönetmen: Bilinmiyor";
        document.querySelector("#second-section p:nth-child(2)").innerText = secilenFilm.release_date ? secilenFilm.release_date.split("-")[0] : "";
        
        const activeCat = document.querySelector(`.category[data-id="${kategoriId}"] h4`);
        document.getElementById("category").innerText = activeCat ? activeCat.innerText : "";

    } catch (error) {
        console.error("API hatası:", error);
    }
}
</script>